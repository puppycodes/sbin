<head>
<title>puppy-bin</title>
<meta name="robots" content="noindex"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css" integrity="sha256-t2/7smZfgrST4FS1DT0bs/KotCM74XlcqZN5Vu7xlrw=" crossorigin="anonymous" />
<style>
    .dos {
        font-family: fixedsys, LucidaTerminal, 'Ubuntu Mono', monospace;
    }
    .dos, textarea, input, button {
        background: #1c1c1c;
    }
    .dos {
        color: #2f9912;
    }

    a {
        color: yellow;
        text-decoration: none;
    }
    .dump-content {
        padding: 1em;
        color: #e3e3e3;
    }
    textarea, input, button, select, .dump-content {
        background-color: #292929;
        border: none;
    }
    textarea, input, button, select {
        color: #e3e3e3;
        outline: none;
        font-size: inherit;
        font-family: inherit;
        padding: 0.2em 0.5em;
    }
    textarea {
        padding: 0.5em;
    }
    button {
        background: none;
        color: yellow;
        cursor: pointer;
    }
    button:disabled {
        color: grey;
        border-color: grey;
        cursor: default;
    }
    .message-box {
        margin-top: 1em;
    }
    .dump-password-form {
        margin-top: 1em;
    }
</style>
</head>
<body class="dos" style="margin: 1em">
<a style="position: relative; width: 20%; display: block; text-align: center; margin: auto; margin-top: 25px; margin-bottom: 25px; min-width: 150px; max-width: 200px;" href="#"><?xml version="1.0" encoding="utf-8"?>
  <?xml version="1.0" encoding="utf-8"?>
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 566.5 67.6" style="enable-background:new 0 0 566.5 67.6;" xml:space="preserve">
<style type="text/css">
	.st0{fill:#FFFFFF;}
</style>
<g>
	<path class="st0" d="M0,0h16.3C32,0,41.5,6.1,41.5,18.8c0,12.5-9.4,18.8-25.2,18.8H7v24.1H0V0z M7,31.5h9.5
		c13,0,17.9-4.9,17.9-12.7c0-7.8-4.9-12.7-17.9-12.7H7V31.5z"/>
	<path class="st0" d="M64.5,40.3V0h7v40.3c0,11.8,3.5,16.2,13.1,16.2c9.7,0,13.2-4.4,13.2-16.2V0h7v40.3c0,16.1-6.6,22.4-20.2,22.4
		C71,62.7,64.5,56.4,64.5,40.3z"/>
	<path class="st0" d="M132.5,0h16.3C164.5,0,174,6.1,174,18.8c0,12.5-9.4,18.8-25.2,18.8h-9.4v24.1h-7V0z M139.4,31.5h9.5
		c13,0,17.9-4.9,17.9-12.7c0-7.8-4.9-12.7-17.9-12.7h-9.5V31.5z"/>
	<path class="st0" d="M198.7,0H215c15.7,0,25.2,6.1,25.2,18.8c0,12.5-9.4,18.8-25.2,18.8h-9.4v24.1h-7V0z M205.7,31.5h9.5
		c13,0,17.9-4.9,17.9-12.7c0-7.8-4.9-12.7-17.9-12.7h-9.5V31.5z"/>
	<path class="st0" d="M279.8,36.7L255.4,0h8.1l9.9,15l10,15.9l9.9-15.9l9.7-15h8.1l-24.4,36.9v24.7h-7V36.7z"/>
	<path class="st0" d="M318.8,61.6h61.4v6h-61.4V61.6z"/>
	<path class="st0" d="M397.4,0h17.7c12.1,0,21.4,5.9,21.4,16.4c0,5.5-2.5,10.2-9.1,13.2c6.4,2.2,11.6,6.8,11.6,14.7
		c0,10.6-9.6,17.2-22,17.2h-19.7V0z M404.4,27h9.7c9.8,0,15.2-3,15.2-10.2c0-6.4-4.4-10.8-14.7-10.8h-10.3V27z M404.4,55.5H417
		c10.5,0,14.8-5.3,14.8-11.6c0-7-5.3-10.8-15.2-10.8h-12.3V55.5z"/>
	<path class="st0" d="M463.5,55.5h15V6.1h-15V0h37v6.1h-15v49.5h15v6.1h-37V55.5z"/>
	<path class="st0" d="M529.9,0h10l20.6,54.6l-0.7-16.6V0h6.6v61.6h-10L535.8,7l0.7,16.6v38.1h-6.6V0z"/>
</g>
</svg>
</a>

<home></home>
<dump></dump>
<faq></faq>
<page404></page>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/sjcl/1.0.6/sjcl.min.js" integrity="sha256-7VEzvbWjCTLLvO8urPO0gk1zqPsLAZVIADdKrwtBbWY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/riot/2.6.2/riot.js" integrity="sha256-T7LwPaiksb1Z5pj4mToQi5ajPL1k0eWnmsGBhTsrZv0=" crossorigin="anonymous"></script>

<script type="text/template" id="tag_home_tpl">
<p><span style="font-weight: bold; color: red" if={data_error}>{ data_error }</span></p>
<form method="post" action="javascript:" id="dump-form">
    <p><textarea style="width: 100%; height: 50%" name="data" onkeyup="{ onFormChange }" onchange="{ onFormChange }"></textarea></p>
    <input style="display: none" type="text" name="iambot" value="" />
    <p>
        <label>password</label>
        <input type="text" name="password" onkeyup="{ onFormChange }" onchange="{ onFormChange }" autocomplete="off"></input>
        &nbsp;
        <label>expires in</label>
        <select name="timeout">
            <option value="">never</option>
            <option value="m10">10 minutes</option>
            <option value="h1">1 hour</option>
            <option value="d1">1 day</option>
            <option value="d7">1 week</option>
            <option value="d30">1 month</option>
        </select>
        &nbsp;
        <button id="submit" type="button" disabled onclick="{ submitForm }">Encrypt &amp; Submit</button>
    </p>
</form>
</script>

<script type="text/template" id="tag_dump_tpl">
<div class="message-box" if="{ error }">
    <div style="color: red">{ error }</div>
</div>
<div if="{ dump }">
    <div class="message-box">
        <div if="{ encrypted }">
            <span if="{ dump.expires_sec }">
            content expires in { formatExpires(dump.expires_sec) }
            </span>
        </div>
        <div if="{ runtimeError }" style="color: red">{ runtimeError }</div>
    </div>
    <pre id="dump-encrypted" style="display: none;">{ dump.data }</pre>
    <pre if="{ !encrypted }" class="dump-content" id="dump-content">{ content }</pre>
    <div class="dump-password-form" id="password-form" if="{ encrypted }">
        <form action="javascript:">
            password:
            <input type="text" name="password" autocomplete="off">
            <button type="button" onclick="{ decrypt }">decrypt</button>
        </form>
    </div>
</div>
</script>


<script type="text/template" id="tag_page404_tpl">
<h1>Requested URL is not found</h1>
</script>

<script>
function tag_home(opts) {
    this.submitForm = function() {
        var pwd = $('input[name="password"]').val();
        if (!pwd) {
            alert('Password is empty');
        } else {
            var data = $('textarea[name="data"]').val();
            if (!data) {
                alert('Data is empty');
            } else {
                var res = sjcl.encrypt(pwd, data, {mode: 'gcm', ts: 128});

                var encData = res;

                var args = {
                    data: encData,
                    iambot: $('input[name="iambot"]').val(),
                    timeout: $('select[name="timeout"]').val()
                }
                $.post('/api/dump', args, function(data) {
                    riot.route(data.dump_id);
                }, 'json');
            }
        }
    }

    this.onFormChange = function() {
        var data = $('textarea[name="data"]').val();
        var pwd = $('input[name="password"]').val();
        if (data && pwd) {
            $('button#submit').attr('disabled', false);
        } else {
            $('button#submit').attr('disabled', true);
        }
    }
};

function tag_dump(opts) {
    var self = this;
    $.get('/api/dump', {dump_id: opts.dump_id}, (data) => {
        console.log(data);
        if (data.error) {
            this.error = data.error;
        } else {
            this.dump = data.dump;
            this.encrypted = true;
        }
        this.update();
    }, 'json');

    this.formatExpires = function(sec) {
        var sec = Math.ceil(sec);
        var days = Math.floor(sec / (60 * 60 * 24));
        var sec = sec - days * (60 * 60 * 24);
        var hours = Math.floor(sec / (60 * 60));
        var sec = sec - hours * (60 * 60);
        var minutes = Math.floor(sec / 60);
        var sec = sec - minutes * 60;
        var res = '';
        if (days) {
            res += (days + ' days ');
        }
        if (hours) {
            res += (hours + ' hr ');
        }
        if (minutes) {
            res += (minutes + ' min ');
        }
        if (sec) {
            res += (sec + ' sec');
        }
        return res;
    }

    this.decrypt = function() {
        var pwd = $('input[name="password"]').val();
        if (pwd) {
            var data = $('#dump-encrypted').text();
            if (data[0] != '{') {
                // Backward-compatiliby with b64-encoded data
                var data = sjcl.codec.utf8String.fromBits(
                    sjcl.codec.base64.toBits(data));
            }
            self.runtimeError = false;
            try {
                this.content = sjcl.decrypt(pwd, data);
                self.encrypted = false;
            } catch(exc) {
                console.log(exc);
                self.runtimeError = 'Password is invalid';
            }
        }
    }
}

riot.tag('home', tag_home_tpl.innerHTML, tag_home);
riot.tag('dump', tag_dump_tpl.innerHTML, tag_dump);
riot.tag('page404', tag_page404_tpl.innerHTML, function(){});

mountedContentTag = null;

riot.route(function(part1, part2) {
    console.log('[route]: part1=' + part1 + ', part2=' + part2);
    if (mountedContentTag) {
        mountedContentTag.unmount(true);
    }
    if (!part1) {
        console.log('[route]: home');
        mountedContentTag = riot.mount('home')[0];
    } else if (part1 && !part2) {
        console.log('[route]: dump');
        mountedContentTag = riot.mount('dump', {dump_id: part1})[0];
    }
      else {
        console.log('[route]: page404');
        mountedContentTag = riot.mount('page404')[0];
    }
});

riot.route.start(true);
</script>
<script>
</script>
</body>
